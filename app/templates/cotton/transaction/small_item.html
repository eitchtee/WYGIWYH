<div class="card bg-base-100 shadow-xl mb-2 transaction-item">
    <div class="card-body p-2 flex items-center gap-3" data-bs-toggle="collapse" data-bs-target="#{{ transaction.id }}" role="button" aria-expanded="false" aria-controls="{{ transaction.id }}">
        <!-- Main visible content -->
        <div class="flex flex-col lg:flex-row lg:items-center w-full gap-3">
            <!-- Type indicator -->
            <div class="w-8">
                {% if transaction.type == 'IN' %}
                    <span class="badge badge-success">↑</span>
                {% else %}
                    <span class="badge badge-error">↓</span>
                {% endif %}
            </div>

            <!-- Payment status -->
            <div class="w-8">
                {% if transaction.is_paid %}
                    <span class="badge badge-success">✓</span>
                {% else %}
                    <span class="badge badge-warning">○</span>
                {% endif %}
            </div>

            <!-- Description -->
            <div class="flex-grow">
                <span class="font-medium">{{ transaction.description }}</span>
            </div>

            <!-- Amount -->
            <div class="text-right whitespace-nowrap">
                <span class="{% if transaction.type == 'IN' %}text-green-400{% else %}text-red-400{% endif %}">
                    {{ transaction.amount }}
                </span>
                {% if transaction.exchanged_amount %}
                    <br>
                    <small class="text-base-content/60">
                        {{ transaction.exchanged_amount.prefix }}{{ transaction.exchanged_amount.amount }}{{ transaction.exchanged_amount.suffix }}
                    </small>
                {% endif %}
            </div>
        </div>
    </div>

    <!-- Expandable details -->
    <div class="collapse" id="{{ transaction.id }}">
      <div class="card-body p-3 transaction-details">
        <div class="grid grid-cols-1 md:grid-cols-2">
            <div>
                <dl class="grid grid-cols-3">
                    <dt class="col-span-1">Date</dt>
                    <dd class="col-span-2">{{ transaction.date|date:"Y-m-d" }}</dd>

                    <dt class="col-span-1">Reference Date</dt>
                    <dd class="col-span-2">{{ transaction.reference_date|date:"Y-m" }}</dd>

                    <dt class="col-span-1">Account</dt>
                    <dd class="col-span-2">{{ transaction.account.name }}</dd>

                    <dt class="col-span-1">Category</dt>
                    <dd class="col-span-2">{{ transaction.category|default:"-" }}</dd>
                </dl>
            </div>
            <div>
                <dl class="grid grid-cols-3">
                    {% if transaction.tags.exists %}
                        <dt class="col-span-1">Tags</dt>
                        <dd class="col-span-2">
                            {% for tag in transaction.tags.all %}
                                <span class="badge badge-secondary">{{ tag.name }}</span>
                            {% endfor %}
                        </dd>
                    {% endif %}

                    {% if transaction.installment_plan %}
                        <dt class="col-span-1">Installment</dt>
                        <dd class="col-span-2">
                            {{ transaction.installment_id }} of {{ transaction.installment_plan.total_installments }}
                        </dd>
                    {% endif %}

                    {% if transaction.recurring_transaction %}
                        <dt class="col-span-1">Recurring</dt>
                        <dd class="col-span-2">Yes</dd>
                    {% endif %}

                    {% if transaction.notes %}
                        <dt class="col-span-1">Notes</dt>
                        <dd class="col-span-2">{{ transaction.notes }}</dd>
                    {% endif %}
                </dl>
            </div>
        </div>
    </div>
    </div>
</div>
