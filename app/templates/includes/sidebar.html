{% load active_link %}
{% load cache_access %}
{% load settings %}
{% load i18n %}
{% load static %}

<div
    class="sidebar {% if request.session.sidebar_status == 'floating' %}tw:group sidebar-floating{% elif request.session.sidebar_status == 'fixed' %}sidebar-fixed{% else %}tw:group sidebar-floating{% endif %}"
    id="sidebar-container">
  <nav
      id="sidebar"
      hx-boost="true"
      hx-swap="transition:true"
      class="offcanvas-lg offcanvas-start tw:lg:flex tw:flex-col tw:fixed tw:top-0 tw:left-0 tw:h-full tw:bg-base-300! tw:shadow-sm tw:z-[1020]">
    <div class="tw:hidden tw:lg:flex tw:items-center tw:justify-between tw:pr-4 tw:border-b tw:border-base-content/10 sidebar-submenu-header">
      <a href="{% url 'index' %}" class="tw:m-0 tw:hidden tw:lg:flex tw:justify-start tw:p-3 tw:no-underline sidebar-title">
        <img src="{% static 'img/logo-icon.svg' %}" alt="WYGIWYH Logo" height="30" width="30" title="WYGIWYH"/>
        <span class="tw:text-2xl tw:font-bold tw:ml-3">WYGIWYH</span>
      </a>

      <button
          id="sidebar-toggle-btn"

          class="tw:btn tw:btn-ghost tw:btn-circle tw:w-12 tw:h-12 tw:flex tw:items-center tw:justify-center tw:transition-all tw:duration-300"
          hx-get="{% url 'toggle_sidebar_status' %}"
          _="on click
           toggle .sidebar-floating on #sidebar-container
           toggle .tw\:group on #sidebar-container
           toggle .sidebar-fixed on #sidebar-container
        end
      "
      >
        <i class="fa-solid fa-thumbtack fa-sm"></i>
        <i class="fa-solid fa-thumbtack-slash fa-sm"></i>
      </button>
    </div>

    <div class="tw:lg:hidden tw:flex tw:justify-between tw:items-center tw:p-4 tw:text-base-content">
      <a href="{% url 'index' %}" class="tw:flex tw:justify-start tw:no-underline">
        <img src="{% static 'img/logo-icon.svg' %}" alt="WYGIWYH Logo" height="30" width="30" title="WYGIWYH"/>
        <span class="tw:text-2xl tw:font-bold tw:ml-3">WYGIWYH</span>
      </a>
      <button type="button" class="tw:btn tw:btn-ghost tw:btn-sm tw:btn-circle" data-bs-target="#sidebar" data-bs-dismiss="offcanvas"
              aria-label={% translate 'Close' %}><i class="fa-solid fa-xmark"></i></button>
    </div>
    <hr class="tw:m-0 tw:text-base-content/60">

    <ul class="tw:list-none tw:p-3 tw:flex tw:flex-col tw:gap-1 tw:whitespace-nowrap tw:lg:group-hover:animate-[disable-pointer-events]"
        style="animation-duration: 100ms">

      <c-components.sidebar-menu-item
          title="{% translate 'Monthly' %}"
          url='monthly_index'
          active="monthly_overview"
          icon="fa-solid fa-list">
      </c-components.sidebar-menu-item>
      <c-components.sidebar-menu-item
          title="{% translate 'Yearly' %}"
          url='yearly_index'
          active="yearly_overview_currency||yearly_overview_account"
          icon="fa-solid fa-calendar-plus">
      </c-components.sidebar-menu-item>
      <c-components.sidebar-menu-item
          title="{% translate 'Calendar' %}"
          url='calendar_index'
          active="calendar"
          icon="fa-solid fa-calendar-days">
      </c-components.sidebar-menu-item>
      <c-components.sidebar-menu-item
          title="{% translate 'Insights' %}"
          url='insights_index'
          active="insights_index"
          icon="fa-solid fa-chart-simple">
      </c-components.sidebar-menu-item>
      <c-components.sidebar-menu-item
          title="{% translate 'Net Worth' %}"
          url='net_worth'
          active="net_worth"
          icon="fa-solid fa-money-bill">
      </c-components.sidebar-menu-item>

      <c-components.sidebar-menu-header title="{% translate 'Transactions' %}"></c-components.sidebar-menu-header>
      <c-components.sidebar-menu-item
          title="{% translate 'All' %}"
          url='transactions_all_index'
          active="transactions_all_index"
          icon="fa-solid fa-right-left">
      </c-components.sidebar-menu-item>
      {% settings "ENABLE_SOFT_DELETE" as enable_soft_delete %}
      {% if enable_soft_delete %}
        <c-components.sidebar-menu-item
            title="{% translate 'Trash Can' %}"
            url='transactions_trash_index'
            active="transactions_trash_index"
            icon="fa-solid fa-trash">
        </c-components.sidebar-menu-item>
      {% endif %}
      <c-components.sidebar-menu-item
          title="{% translate 'Quick Transactions' %}"
          url='quick_transactions_index'
          active="quick_transactions_index"
          icon="fa-solid fa-person-running">
      </c-components.sidebar-menu-item>
      <c-components.sidebar-menu-item
          title="{% translate 'Installment Plans' %}"
          url='installment_plans_index'
          active="installment_plans_index"
          icon="fa-solid fa-divide">
      </c-components.sidebar-menu-item>
      <c-components.sidebar-menu-item
          title="{% translate 'Recurring Transactions' %}"
          url='recurring_trasanctions_index'
          active="recurring_trasanctions_index"
          icon="fa-solid fa-repeat">
      </c-components.sidebar-menu-item>

      <c-components.sidebar-menu-header title="{% translate 'Tools' %}"></c-components.sidebar-menu-header>
      <c-components.sidebar-menu-item
          title="{% translate 'Dollar Cost Average Tracker' %}"
          url='dca_strategy_index'
          active="dca_strategy_index||dca_strategy_detail_index"
          icon="fa-solid fa-magnifying-glass-chart">
      </c-components.sidebar-menu-item>
      <c-components.sidebar-menu-item
          title="{% translate 'Unit Price Calculator' %}"
          url='unit_price_calculator'
          active="unit_price_calculator"
          icon="fa-solid fa-tags">
      </c-components.sidebar-menu-item>
      <c-components.sidebar-menu-item
          title="{% translate 'Currency Converter' %}"
          url='currency_converter'
          active="currency_converter"
          icon="fa-solid fa-money-bill-transfer">
      </c-components.sidebar-menu-item>

      <div>
        <hr class="tw:border-base-300">
      </div>

      <div role="button"
           data-bs-toggle="collapse"
           data-bs-target="#collapsible-panel"
           aria-expanded="false"
           aria-controls="collapsible-panel"
           class="sidebar-menu-item tw:text-wrap tw:lg:text-nowrap tw:lg:text-sm tw:flex tw:items-center tw:no-underline tw:p-2 tw:rounded-2xl tw:cursor-pointer sidebar-item {% active_link views='tags_index||entities_index||categories_index||accounts_index||account_groups_index||currencies_index||exchange_rates_index||rules_index||import_profiles_index||automatic_exchange_rates_index||export_index||users_index' css_class="sidebar-active" %}">
        <i class="fa-solid fa-toolbox fa-fw"></i>
        <span class="tw:ml-3 tw:font-medium tw:lg:group-hover:truncate tw:lg:group-focus:truncate tw:lg:group-hover:text-ellipsis tw:lg:group-focus:text-ellipsis">
          {% translate 'Management' %}
        </span>
        <i class="fa-solid fa-chevron-right fa-fw tw:ml-auto tw:pe-2"></i>
      </div>
    </ul>

    <div class="tw:mt-auto tw:p-2 tw:w-full">
      <div id="collapsible-panel"
           class="tw:p-0 collapse tw:absolute tw:bottom-0 tw:left-0 tw:w-full tw:z-30 tw:max-h-dvh {% active_link views='tags_index||entities_index||categories_index||accounts_index||account_groups_index||currencies_index||exchange_rates_index||rules_index||import_profiles_index||automatic_exchange_rates_index||export_index||users_index' css_class="show" %}">
        <div class="tw:h-dvh tw:backdrop-blur-3xl tw:flex tw:flex-col">
          <div
              class="tw:justify-between tw:items-center tw:p-4 tw:border-b tw:border-base-content/10 sidebar-submenu-header tw:text-base-content">
            <h5 class="tw:text-lg tw:font-semibold tw:text-base-content tw:m-0">
              {% trans 'Management' %}
            </h5>

            <button type="button" class="tw:btn tw:btn-ghost tw:btn-sm tw:btn-circle" aria-label="{% trans 'Close' %}"
                    data-bs-toggle="collapse"
                    data-bs-target="#collapsible-panel"
                    aria-expanded="true"
                    aria-controls="collapsible-panel">
              <i class="fa-solid fa-xmark"></i>
            </button>
          </div>

          <ul class="tw:list-none tw:p-3 tw:flex tw:flex-col tw:gap-2 tw:lg:group-hover:animate-[disable-pointer-events] tw:flex-1"
              style="animation-duration: 100ms">
            <c-components.sidebar-menu-header title="{% translate 'Transactions' %}"></c-components.sidebar-menu-header>
            <c-components.sidebar-menu-item
                title="{% translate 'Categories' %}"
                url='categories_index'
                active="categories_index"
                icon="fa-solid fa-icons">
            </c-components.sidebar-menu-item>
            <c-components.sidebar-menu-item
                title="{% translate 'Tags' %}"
                url='tags_index'
                active="tags_index"
                icon="fa-solid fa-hashtag">
            </c-components.sidebar-menu-item>
            <c-components.sidebar-menu-item
                title="{% translate 'Entities' %}"
                url='entities_index'
                active="entities_index"
                icon="fa-solid fa-user-group">
            </c-components.sidebar-menu-item>

            <c-components.sidebar-menu-header title="{% translate 'Accounts' %}"></c-components.sidebar-menu-header>
            <c-components.sidebar-menu-item
                title="{% translate 'Accounts' %}"
                url='accounts_index'
                active="accounts_index"
                icon="fa-solid fa-wallet">
            </c-components.sidebar-menu-item>
            <c-components.sidebar-menu-item
                title="{% translate 'Account Groups' %}"
                url='account_groups_index'
                active="account_groups_index"
                icon="fa-solid fa-wallet">
            </c-components.sidebar-menu-item>

            <c-components.sidebar-menu-header title="{% translate 'Currencies' %}"></c-components.sidebar-menu-header>
            <c-components.sidebar-menu-item
                title="{% translate 'Currencies' %}"
                url='currencies_index'
                active="currencies_index"
                icon="fa-solid fa-coins">
            </c-components.sidebar-menu-item>
            <c-components.sidebar-menu-item
                title="{% translate 'Exchange Rates' %}"
                url='exchange_rates_index'
                active="exchange_rates_index"
                icon="fa-solid fa-right-left">
            </c-components.sidebar-menu-item>

            <c-components.sidebar-menu-header title="{% translate 'Automation' %}"></c-components.sidebar-menu-header>
            <c-components.sidebar-menu-item
                title="{% translate 'Rules' %}"
                url='rules_index'
                active="rules_index"
                icon="fa-solid fa-pen-ruler">
            </c-components.sidebar-menu-item>
            <c-components.sidebar-menu-item
                title="{% translate 'Import' %}"
                url='import_profiles_index'
                active="import_profiles_index"
                icon="fa-solid fa-file-import">
            </c-components.sidebar-menu-item>
            {% if user.is_superuser %}
              <c-components.sidebar-menu-item
                  title="{% translate 'Export and Restore' %}"
                  url='export_index'
                  active="export_index"
                  icon="fa-solid fa-file-export">
              </c-components.sidebar-menu-item>
            {% endif %}
            <c-components.sidebar-menu-item
                title="{% translate 'Automatic Exchange Rates' %}"
                url='automatic_exchange_rates_index'
                active="automatic_exchange_rates_index"
                icon="fa-solid fa-right-left">
            </c-components.sidebar-menu-item>

            {% if user.is_superuser %}
              <c-components.sidebar-menu-header title="{% translate 'Admin' %}"></c-components.sidebar-menu-header>
              <c-components.sidebar-menu-item
                  title="{% translate 'Users' %}"
                  url='users_index'
                  active="users_index"
                  icon="fa-solid fa-users">
              </c-components.sidebar-menu-item>
              <c-components.sidebar-menu-url-item
                  title="{% translate 'Django Admin' %}"
                  tooltip="{% translate "Only use this if you know what you're doing" %}"
                  url='/admin/'
                  icon="fa-solid fa-screwdriver-wrench">
              </c-components.sidebar-menu-url-item>
            {% endif %}
          </ul>
        </div>
      </div>
      {% get_update_check as update_check %}
      {% if update_check.update_available %}
        <div class="tw:my-3">
          <a class="tw:px-3 tw:badge tw:badge-primary tw:no-underline tw:cursor-pointer tw:w-full !tw:text-xs"
             href="https://github.com/eitchtee/WYGIWYH/releases/latest" target="_blank"><i
              class="fa-solid fa-circle-exclamation fa-fw tw:mr-2"></i><span
              class="tw:lg:invisible tw:lg:group-hover:visible">v.{{ update_check.latest_version }} {% translate 'is available' %}!</span></a>
        </div>
      {% endif %}

      <div class="tw:btn-group tw:w-full sidebar-item" role="group">
        <button type="button" class="tw:btn tw:btn-secondary tw:btn-sm tw:w-full" data-bs-toggle="tooltip"
                data-bs-title="{% trans "Calculator" %}"
                _="on click trigger show on #calculator">
          <i class="fa-solid fa-calculator fa-fw"></i>
        </button>
      </div>
    </div>

    <div>
      <hr class="tw:my-1 tw:border-base-300">
      <div
          class="tw:ps-4 tw:pe-2 tw:py-2 tw:flex tw:items-center tw:no-underline tw:justify-between">

        <div class="tw:flex tw:items-center" style="min-width: 0;">
          <i class="fa-solid fa-circle-user tw:text-base-content/60"></i>

          <strong class="tw:mx-2 tw:text-base-content/60 tw:truncate sidebar-invisible">
            {{ user.email }}
          </strong>
        </div>

        <div class="sidebar-invisible">
          {% include 'includes/navbar/user_menu.html' %}
        </div>

      </div>
    </div>
  </nav>

  <div
      class="tw:hidden tw:lg:group-hover:block tw:absolute tw:top-0 tw:left-104 tw:w-16 tw:h-full tw:bg-transparent"></div>
</div>
