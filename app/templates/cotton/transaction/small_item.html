<div class="tw:card tw:bg-base-100 tw:shadow-xl tw:mb-2 transaction-item">
    <div class="tw:card-body tw:p-2 tw:flex tw:items-center tw:gap-3" data-bs-toggle="collapse" data-bs-target="#{{ transaction.id }}" role="button" aria-expanded="false" aria-controls="{{ transaction.id }}">
        <!-- Main visible content -->
        <div class="tw:flex tw:flex-col tw:lg:flex-row tw:lg:items-center tw:w-full tw:gap-3">
            <!-- Type indicator -->
            <div class="tw:w-8">
                {% if transaction.type == 'IN' %}
                    <span class="tw:badge tw:badge-success">↑</span>
                {% else %}
                    <span class="tw:badge tw:badge-error">↓</span>
                {% endif %}
            </div>

            <!-- Payment status -->
            <div class="tw:w-8">
                {% if transaction.is_paid %}
                    <span class="tw:badge tw:badge-success">✓</span>
                {% else %}
                    <span class="tw:badge tw:badge-warning">○</span>
                {% endif %}
            </div>

            <!-- Description -->
            <div class="tw:flex-grow">
                <span class="tw:font-medium">{{ transaction.description }}</span>
            </div>

            <!-- Amount -->
            <div class="tw:text-right tw:whitespace-nowrap">
                <span class="{% if transaction.type == 'IN' %}tw:text-green-400{% else %}tw:text-red-400{% endif %}">
                    {{ transaction.amount }}
                </span>
                {% if transaction.exchanged_amount %}
                    <br>
                    <small class="tw:text-base-content/60">
                        {{ transaction.exchanged_amount.prefix }}{{ transaction.exchanged_amount.amount }}{{ transaction.exchanged_amount.suffix }}
                    </small>
                {% endif %}
            </div>
        </div>
    </div>

    <!-- Expandable details -->
    <div class="tw:collapse" id="{{ transaction.id }}">
      <div class="tw:card-body tw:p-3 transaction-details">
        <div class="tw:grid tw:grid-cols-1 tw:md:grid-cols-2">
            <div>
                <dl class="tw:grid tw:grid-cols-3">
                    <dt class="tw:col-span-1">Date</dt>
                    <dd class="tw:col-span-2">{{ transaction.date|date:"Y-m-d" }}</dd>

                    <dt class="tw:col-span-1">Reference Date</dt>
                    <dd class="tw:col-span-2">{{ transaction.reference_date|date:"Y-m" }}</dd>

                    <dt class="tw:col-span-1">Account</dt>
                    <dd class="tw:col-span-2">{{ transaction.account.name }}</dd>

                    <dt class="tw:col-span-1">Category</dt>
                    <dd class="tw:col-span-2">{{ transaction.category|default:"-" }}</dd>
                </dl>
            </div>
            <div>
                <dl class="tw:grid tw:grid-cols-3">
                    {% if transaction.tags.exists %}
                        <dt class="tw:col-span-1">Tags</dt>
                        <dd class="tw:col-span-2">
                            {% for tag in transaction.tags.all %}
                                <span class="tw:badge tw:badge-secondary">{{ tag.name }}</span>
                            {% endfor %}
                        </dd>
                    {% endif %}

                    {% if transaction.installment_plan %}
                        <dt class="tw:col-span-1">Installment</dt>
                        <dd class="tw:col-span-2">
                            {{ transaction.installment_id }} of {{ transaction.installment_plan.total_installments }}
                        </dd>
                    {% endif %}

                    {% if transaction.recurring_transaction %}
                        <dt class="tw:col-span-1">Recurring</dt>
                        <dd class="tw:col-span-2">Yes</dd>
                    {% endif %}

                    {% if transaction.notes %}
                        <dt class="tw:col-span-1">Notes</dt>
                        <dd class="tw:col-span-2">{{ transaction.notes }}</dd>
                    {% endif %}
                </dl>
            </div>
        </div>
    </div>
    </div>
</div>
