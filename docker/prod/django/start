#!/bin/bash

set -o errexit
set -o pipefail
set -o nounset

# Set INTERNAL_PORT with default value of 8000
INTERNAL_PORT=${INTERNAL_PORT:-8000}

# Remove flag file if it exists from previous run
rm -f /tmp/migrations_complete

python manage.py migrate

# Create flag file to signal migrations are complete
touch /tmp/migrations_complete

python manage.py setup_users

exec gunicorn WYGIWYH.wsgi:application --bind 0.0.0.0:$INTERNAL_PORT --timeout 600
