{% load currency_display %}
{% load i18n %}
<div class="tw:card-body show-loading" hx-get="{% url 'exchange_rates_list_pair' %}" hx-trigger="updated from:window" hx-swap="outerHTML" hx-vals='{"page": "{{ page_obj.number }}", "from": "{{ from_currency|default_if_none:"" }}", "to": "{{ to_currency|default_if_none:"" }}"}'>
  {% if page_obj %}
  <div class="tw:overflow-x-auto">
    <table class="tw:table tw:table-hover tw:whitespace-nowrap">
      <thead>
        <tr>
          <th scope="col" class="tw:w-auto"></th>
          <th scope="col">{% translate 'Date' %}</th>
          <th scope="col">{% translate 'Pairing' %}</th>
          <th scope="col">{% translate 'Rate' %}</th>
        </tr>
      </thead>
      <tbody>
        {% for exchange_rate in page_obj %}
        <tr class="exchange-rate">
          <td class="tw:w-auto">
            <div class="tw:join" role="group" aria-label="{% translate 'Actions' %}">
              <a class="tw:btn tw:btn-secondary tw:btn-sm tw:join-item"
                    role="button"
                    data-bs-toggle="tooltip"
                    data-bs-title="{% translate "Edit" %}"
                    hx-get="{% url 'exchange_rate_edit' pk=exchange_rate.id %}"
                    hx-target="#generic-offcanvas"
                    hx-swap="innerHTML">
                <i class="fa-solid fa-pencil fa-fw"></i></a>
              <a class="tw:btn tw:btn-secondary tw:btn-sm tw:join-item tw:text-error"
                      role="button"
                      data-bs-toggle="tooltip"
                      data-bs-title="{% translate "Delete" %}"
                      hx-delete="{% url 'exchange_rate_delete' pk=exchange_rate.id %}"
                      hx-trigger='confirmed'
                      hx-swap="innerHTML"
                      data-bypass-on-ctrl="true"
                      data-title="{% translate "Are you sure?" %}"
                      data-text="{% translate "You won't be able to revert this!" %}"
                      data-confirm-text="{% translate "Yes, delete it!" %}"
                      _="install prompt_swal"><i class="fa-solid fa-trash fa-fw"></i></a>
            </div>
          </td>
          <td class="tw:w-1/4">{{ exchange_rate.date|date:"SHORT_DATETIME_FORMAT" }}</td>
          <td class="tw:w-1/4"><span class="tw:badge tw:badge-secondary tw:rounded-full">{{ exchange_rate.from_currency.name }}</span> x <span class="tw:badge tw:badge-secondary tw:rounded-full">{{ exchange_rate.to_currency.name }}</span></td>
          <td class="tw:w-1/4">1 {{ exchange_rate.from_currency.name }} ≅ {% currency_display amount=exchange_rate.rate prefix=exchange_rate.to_currency.prefix suffix=exchange_rate.to_currency.suffix decimal_places=exchange_rate.to_currency.decimal_places%}</td>
        </tr>
        {% endfor %}
      </tbody>
    </table>
  </div>
  {% else %}
    <c-msg.empty title="{% translate "No exchange rates" %}" remove-padding></c-msg.empty>
  {% endif %}

  {% if page_obj.has_other_pages %}
  <div class="tw:mt-auto">
    <input value="{{ page_obj.number }}" name="page" type="hidden" id="page">

    <nav aria-label="{% translate 'Page navigation' %}">
    <div class="tw:join tw:flex tw:justify-center tw:mt-5">
      <button class="tw:join-item tw:btn tw:btn-sm tw:cursor-pointer {% if not page_obj.has_previous %}tw:btn-disabled{% endif %}"
           hx-get="{% if page_obj.has_previous %}{% url 'exchange_rates_list_pair' %}{% endif %}"
           hx-vals='{"page": 1, "from": "{{ from_currency|default_if_none:"" }}", "to": "{{ to_currency|default_if_none:"" }}"}'
           hx-include="#filter, #order"
           hx-target="#exchange-rates-table"
           aria-label="Primeira página"
           hx-swap="show:top">
          <span aria-hidden="true">&laquo;</span>
        </button>
      {% for page_number in page_obj.paginator.page_range %}
              {% comment %}
                  This conditional allows us to display up to 3 pages before and after the current page
                  If you decide to remove this conditional, all the pages will be displayed

                  You can change the 3 to any number you want e.g
                  To display only 5 pagination items, change the 3 to 2 (2 before and 2 after the current page)
              {% endcomment %}
              {% if page_number <= page_obj.number|add:3 and page_number >= page_obj.number|add:-3 %}
                  {% if page_obj.number == page_number %}
                      <button class="tw:join-item tw:btn tw:btn-sm tw:btn-active tw:cursor-pointer">
                              {{ page_number }}
                          </button>
                  {% else %}
                      <button class="tw:join-item tw:btn tw:btn-sm tw:cursor-pointer"
                             hx-get="{% url 'exchange_rates_list_pair' %}"
                             hx-vals='{"page": {{ page_number }}, "from": "{{ from_currency|default_if_none:"" }}", "to": "{{ to_currency|default_if_none:"" }}"}'
                             hx-target="#exchange-rates-table"
                             hx-swap="show:top">
                              {{ page_number }}
                          </button>
                  {% endif %}
              {% endif %}
      {% endfor %}
      {% if page_obj.number|add:3 < page_obj.paginator.num_pages %}
        <button class="tw:join-item tw:btn tw:btn-sm tw:btn-disabled"
             aria-label="...">
            <span aria-hidden="true">...</span>
          </button>
        <button class="tw:join-item tw:btn tw:btn-sm tw:cursor-pointer"
             hx-get="{% url 'exchange_rates_list_pair' %}" hx-target="#exchange-rates-table"
             hx-vals='{"page": {{ page_obj.paginator.num_pages }}, "from": "{{ from_currency|default_if_none:"" }}", "to": "{{ to_currency|default_if_none:"" }}"}'
             hx-include="#filter, #order"
             hx-swap="show:top"
             aria-label="Última página">
            <span aria-hidden="true">{{ page_obj.paginator.num_pages }}</span>
          </button>
      {% endif %}
      <button class="tw:join-item tw:btn tw:btn-sm {% if not page_obj.has_next %}tw:btn-disabled{% endif %} tw:cursor-pointer"
           hx-get="{% if page_obj.has_next %}{% url 'exchange_rates_list_pair' %}{% endif %}"
           hx-vals='{"page": {{ page_obj.paginator.num_pages }}, "from": "{{ from_currency|default_if_none:"" }}", "to": "{{ to_currency|default_if_none:"" }}"}'
           hx-include="#filter, #order"
           hx-swap="show:top"
           hx-target="#exchange-rates-table"
           aria-label="Next">
          <span aria-hidden="true">&raquo;</span>
        </button>
    </div>
  </nav>
  </div>
  {% endif %}
</div>
